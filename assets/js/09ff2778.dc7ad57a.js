"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([[506],{5749:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var r=n(4848),a=n(8453);const o={title:"Handy bash backup script",description:"How to automatically backup your home directory",slug:"backup-script",authors:"DocWizard",tags:["Linux","bash","backup"],image:"/img/logo.png",hide_table_of_contents:!1,draft:!1},i=void 0,s={permalink:"/blog/backup-script",source:"@site/blog/2024-04-16-bash-backup.md",title:"Handy bash backup script",description:"How to automatically backup your home directory",date:"2024-04-16T00:00:00.000Z",tags:[{label:"Linux",permalink:"/blog/tags/linux"},{label:"bash",permalink:"/blog/tags/bash"},{label:"backup",permalink:"/blog/tags/backup"}],readingTime:4.725,hasTruncateMarker:!0,authors:[{name:"Maciej Kitlasz (DocWizard)",title:"Technical Writer",url:"https://www.kitlasz.eu/",imageURL:"/blog/img/face.png",key:"DocWizard"}],frontMatter:{title:"Handy bash backup script",description:"How to automatically backup your home directory",slug:"backup-script",authors:"DocWizard",tags:["Linux","bash","backup"],image:"/img/logo.png",hide_table_of_contents:!1,draft:!1},unlisted:!1,prevItem:{title:"Unix directory structure",permalink:"/blog/dir-structure"},nextItem:{title:"Stuck in Limbo - How to Handle Radio-Silent SMEs in Technical Writing",permalink:"/blog/SME-handling-tips"}},c={authorsImageUrls:[void 0]},l=[{value:"3-2-1 backup strategy",id:"3-2-1-backup-strategy",level:3},{value:"Backup script",id:"backup-script",level:3},{value:"Backing up my packages",id:"backing-up-my-packages",level:3},{value:"Summary",id:"summary",level:3}];function h(e){const t={a:"a",code:"code",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.p,{children:"Making regular backups is a must! If you're still one of those people who remain unconvinced of this, then a) I envy you and b) Just wait for your first hardware-related disaster to happen - you'll sing a different tune. I, for one, have set up a simple bash script that automates syncing my home directory with an external hard drive every month."}),"\n",(0,r.jsx)(t.p,{children:"You never know when your hard drive or SSD is going to give up the spirit. When it does, the consequences are entirely dependent on your previous actions. I like to follow the 3-2-1 backup strategy."}),"\n",(0,r.jsx)(t.h3,{id:"3-2-1-backup-strategy",children:"3-2-1 backup strategy"}),"\n",(0,r.jsx)(t.p,{children:"This is a data protection strategy that's simple enough for a 'normal' person to use, yet offers robust protection for your personal data. It's easy to remember:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Maintain ",(0,r.jsx)("b",{children:"three"})," copies of your data - one can be the main copy on your personal computer, but you need at least two more copies."]}),"\n",(0,r.jsxs)(t.li,{children:["Use ",(0,r.jsx)("b",{children:"two"})," different types of media - say, keep one copy on an external hard drive, and the other in the cloud."]}),"\n",(0,r.jsxs)(t.li,{children:["Keep ",(0,r.jsx)("b",{children:"one"})," copy in a secondary location - just imagine that there's a fire and both your PC and the external hard drive you keep in your drawer burn down? This can be a server in the cloud, or... keep the external HDD at your parents' house :)"]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"Personally, I went with the path of least resistance: I have a copy of my most important files uploaded on OneDrive, and an external drive onto which I regularly upload my entire /home directory."}),"\n",(0,r.jsx)(t.h3,{id:"backup-script",children:"Backup script"}),"\n",(0,r.jsx)(t.p,{children:"Now, theoretically I could just remember to backup my all files regularly. Unfortunately, mother nature has gifted me with a rather fickle memory. Besides, automation is fun! That's why I have a bash script scheduled to run on the 1st of every month, not only reminding me to make the backup, but also actually running it for me. I'll share the script with you - but don't blindly trust me, (or any script you download from the Internet, really). Be sure to go through it and figure out exactly what it does on your own!"}),"\n",(0,r.jsx)(t.p,{children:"This should work on any Linux distribution. I'm running Arch, btw."}),"\n",(0,r.jsx)(t.p,{children:"First, as with any script, we specify the shell interpeter to use:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"#!/bin/bash\n"})}),"\n",(0,r.jsx)(t.p,{children:"Then, I want to check if the external drive is mounted. First, I'll send myself a reminder to actually do it:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'echo "It\'s time for your monthly /home backup. Connect your external drive."\nread -p "Press enter to continue..."\n\nif [ ! -d "/run/media/maciejk/Data2/" ]; then\n    echo "External hard drive is not mounted."\n    exit 1\nfi\n'})}),"\n",(0,r.jsx)(t.p,{children:"You need to change the path to your own external HDD's mounting point.As you see, if the drive still isn't mounted, then the script exits. If it is mounted, then we begin to copy everything over. We'll also have a nice message at the end, indicating if everything went according to plan:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'rsync -avh --progress /home/maciejk/ /run/media/maciejk/Data2/homebackup\nif [ $? -eq 0 ]; then\n    echo "Backup completed successfully."\nelse\n    echo "Backup failed."\nfi\n'})}),"\n",(0,r.jsx)(t.p,{children:"Again, change the paths to suit your own purposes. Save the script to a convenient place - ~/bin works just fine. Remember to add .sh at the end of your filename."}),"\n",(0,r.jsx)(t.p,{children:"And that's it, that's the basic version of the script. For it to run automatically, you will need to schedule its execution using cron:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"crontab -e\n"})}),"\n",(0,r.jsx)(t.p,{children:"And add a new line to your crontab file:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"0 20 1 * * /path/to-yourscript.sh\n"})}),"\n",(0,r.jsxs)(t.p,{children:["You will need to replace ",(0,r.jsx)("i",{children:"/path/to-yourscript.sh"})," with the path to your script, of course. This runs the script at 20:00 every first day of the month. If you want to run the script on a different timeline, I recommend using ",(0,r.jsx)(t.a,{href:"https://crontab.guru/",children:"fcrontab.guru"})," to generate your own version of this line."]}),"\n",(0,r.jsx)(t.h3,{id:"backing-up-my-packages",children:"Backing up my packages"}),"\n",(0,r.jsx)(t.p,{children:"All this isn't enough for me. I have my /home directory backed up, but what if I need to reinstall my system from scratch? Do I have to remember what packages I had installed? No, we can save a list of installed packages as well by adding the following line to our script, right before the rsync operation:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"pacman -Qqe > ~/.myPackages.txt\n"})}),"\n",(0,r.jsx)(t.p,{children:"This is on Arch - any Arch-based distro will support this, but for apt or dnf, you'll have to figure it out on your own. Sorry!"}),"\n",(0,r.jsxs)(t.p,{children:["What this does is create a list of all your ",(0,r.jsx)("b",{children:"explicitly"})," installed packages - that is those that you, yourself have installed so far. If you ever need to reinstall everything from scratch, simply run:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"pacman -S --needed - < ~/.myPackages.txt\n"})}),"\n",(0,r.jsx)(t.p,{children:"And everything that was installed at the moment you made your backup should be restored."}),"\n",(0,r.jsx)(t.h3,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(t.p,{children:"So, to summarize - here's the complete version of my script. Remember to change the paths to reflect your own filesystem!"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'#!/bin/bash\n\n# Display a message prompting the user to plug in the external drive\necho "It\'s time for your monthly /home backup. Plug your external drive in and press enter to continue."\nread -p "Press enter to continue..."\n\n# Check if the external hard drive is mounted\nif [ ! -d "/run/media/maciejk/Data2/" ]; then\n    echo "External hard drive is not mounted."\n    exit 1\nfi\n\n# Create a list of explicitly installed packages\necho "Drive detected, creating package list..."\npacman -Qqe > ~/.myPackages.txt\n\n# Copy the entire home directory to the external hard drive\nrsync -avh --progress /home/maciejk/ /run/media/maciejk/Data2/homebackup\n\n# Check if rsync was successful\nif [ $? -eq 0 ]; then\n    echo "Backup completed successfully."\nelse\n    echo "Backup failed."\nfi\n'})})]})}function u(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>s});var r=n(6540);const a={},o=r.createContext(a);function i(e){const t=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);